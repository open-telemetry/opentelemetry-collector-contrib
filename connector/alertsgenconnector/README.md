# AlertsGen Connector
<!-- status autogenerated section -->
<!-- end autogenerated section -->

A **stream-based alert evaluation** connector for the OpenTelemetry Collector.
It evaluates **metrics, logs, and traces** in a **sliding 5-second window** (ns precision),
emits **alert events** as logs and **alert state** as metrics, and **synchronizes state**
via a Prometheus-compatible TSDB.

> ⚠️ **Sizing Note**: Larger time windows increase **CPU** (more samples scanned/aggregated)
> and **Memory** (more buckets/state kept). Start with the **recommended 5s window** and
> scale cautiously.

## Key Features
- Tri-signal evaluation: traces (duration/status), logs (severity/body), metrics (values)
- Sliding window (default **5s**), **nanosecond**-precision time math
- `for:` duration with persistence across restarts
- TSDB-based state coordination (remote-read HTTP API)
- Multi-layer dedup (fingerprint + TSDB + downstream alertmanager)
- Storm prevention (global/per-rule limits, circuit breaker)
- Cardinality control (label limits, hashing, sampling)
- AlertManager v2 API notifier (optional)

## Minimal config
```yaml
connectors:
  alertsgen:
    window_size: 5s           # recommended default
    instance_id: collector-pod-1

    # TSDB read endpoint (Prometheus/VM compatible /api/v1/query)
    tsdb:
      query_url: http://prometheus:9090

    dedup:
      fingerprint_labels: [alertname, severity, cluster, namespace, service]
      exclude_labels: [pod_ip, container_id, timestamp]
      window: 30s

    storm:
      max_alerts_per_minute: 100
      circuit_breaker_threshold: 0.5

    cardinality:
      max_labels_per_alert: 20
      max_series_per_rule: 1000
      hash_if_exceeds: 128

    notify:
      alertmanager_urls: ["http://alertmanager:9093/api/v2/alerts"]

    rules:
      - name: high_p99_latency
        signal: traces
        select:
          service.name: "payments|checkout"
        group_by: [service.name, http.route]
        window: 5s
        step: 5s
        for: 30s
        severity: critical
        expr:
          type: latency_quantile_over_time
          field: duration_ns        # ns precision
          quantile: 0.99
          op: ">"
          value: 400000000          # 400ms in ns
        outputs:
          log: {}
          metric:
            name: alerts_active
```

## Build (inside contrib repo root)
```bash
make crosslink
make generate
make gotidy
```

## Pipelines
Declare the connector on traces/logs/metrics pipelines and add output pipelines for alert logs & metrics.
