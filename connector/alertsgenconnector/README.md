# AlertsGen Connector
<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aconnector%2Falertsgen%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aconnector%2Falertsgen) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aconnector%2Falertsgen%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aconnector%2Falertsgen) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=connector_alertsgen)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=connector_alertsgen&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@aarvee11](https://www.github.com/aarvee11) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib

## Supported Pipeline Types

| [Exporter Pipeline Type] | [Receiver Pipeline Type] | [Stability Level] |
| ------------------------ | ------------------------ | ----------------- |
| traces | logs | [development] |
| metrics | logs | [development] |

[Exporter Pipeline Type]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/connector/README.md#exporter-pipeline-type
[Receiver Pipeline Type]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/connector/README.md#receiver-pipeline-type
[Stability Level]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#stability-levels
<!-- end autogenerated section -->

The **AlertsGen Connector** evaluates incoming OpenTelemetry signals (metrics, logs, traces) against declarative rules and generates **synthetic alerts** as structured logs and metrics.  
It is designed for environments that require **real-time alerting**, **storm control**, **deduplication**, and **high-availability coordination** with external TSDBs (Prometheus, VictoriaMetrics).

---

## üöÄ Purpose

- Provide **rule-based alert evaluation** directly inside the OpenTelemetry Collector.  
- Emit **structured alert logs** and **synthetic alert metrics** for downstream systems (e.g., logging backends, TSDB, Prometheus, Grafana, SIEMs).  
- Support **storm control**, **cardinality limiting**, and **HA coordination** with external TSDBs (Prometheus, VictoriaMetrics).  
- Provide **self-telemetry** to monitor the health and performance of the connector.  

---

## üîß Use-Cases

- **Kubernetes**: Inline alerting for container workloads, dedup across HA replicas.  
- **Bare-metal / VMs**: Lightweight evaluation for infra-level telemetry (CPU, memory, logs).  
- **Air-gapped / regulated environments**: Works without requiring external Prometheus if TSDB is disabled.  
- **Storm & cardinality protection**: Prevents alert floods and excessive label growth.  

---

## üìê Architecture (Flow)

```
 Traces / Logs / Metrics  ‚îÄ‚îê
                          ‚îú‚îÄ‚îÄ> AlertsGen Connector
                          ‚îÇ
                          ‚îÇ   ‚îå‚îÄ‚îÄ Rule Evaluation
                          ‚îÇ   ‚îú‚îÄ‚îÄ Deduplication
                          ‚îÇ   ‚îú‚îÄ‚îÄ Storm Control
                          ‚îÇ   ‚îî‚îÄ‚îÄ Cardinality Control
                          ‚îÇ
                          ‚îú‚îÄ‚îÄ> Synthetic Alert Logs (structured)
                          ‚îî‚îÄ‚îÄ> Synthetic Alert Metrics (counters/gauges)
```

---

## ‚öôÔ∏è Example Config (`config.yaml`)

```yaml
receivers:
  otlp:
    protocols:
      grpc:
      http:

connectors:
  alertsgen:
    window: 5s
    step: 5s
    instance_id: "otel-collector-1"  # Set unique per pod/VM for HA
    tsdb:
      enabled: false                 # For Kubernetes, set true with query_url to enable HA state restore
      query_url: ""                  # e.g., http://prometheus:9090
      enable_remote_write: false
    dedup:
      fingerprint_labels: ["alertname", "severity", "cluster", "namespace", "service"]
      exclude_labels: ["pod_ip", "container_id", "timestamp", "trace_id"]
      window: 30s
    limits:
      storm:
        max_transitions_per_minute: 100
        max_events_per_interval: 50
        interval: 1s
      cardinality:
        max_labels: 20
        max_label_value_length: 128
        max_total_label_size: 2048
        allowlist: ["alertname", "severity", "rule_id"]
        blocklist: ["pod_ip", "container_id", "trace_id"]
    notify:
      enabled: true
      timeout: 10s
    memory:
      max_memory_percent: 0.10
      enable_adaptive_scaling: true
      enable_memory_pressure_handling: true
    rules:
      - name: high_cpu
        signal: metrics
        expr:
          type: avg_over_time
          field: cpu.usage
          op: ">"
          value: 0.9
        for: 30s
        severity: critical
        group_by: ["namespace", "pod"]

exporters:
  logging:
    loglevel: debug
  prometheus:
    endpoint: "0.0.0.0:9464"

service:
  pipelines:
    metrics:
      receivers: [otlp]
      processors: []
      connectors: [alertsgen]
      exporters: [prometheus]
    logs:
      receivers: [otlp]
      processors: []
      connectors: [alertsgen]
      exporters: [logging]
```

> **Kubernetes**: set `instance_id` to pod name and enable `tsdb.enabled: true` with a valid `query_url`.  
> **VMs / Bare Metal**: keep `enabled: false` for TSDB unless HA deduplication is needed.  

---

## üìù Emitted Signals

### ‚úÖ Logs (Structured Alert Events)

Each generated alert log contains:

| Field       | Description |
|-------------|-------------|
| `alertname` | Name of the alert (from rule). |
| `rule_id`   | Unique identifier of the rule. |
| `severity`  | Severity level (info/warning/critical). |
| `state`     | State of the alert (`firing`, `resolved`). |
| `value`     | Evaluated value triggering the alert. |
| `window`    | Evaluation window in seconds. |
| `for`       | Duration threshold before firing. |
| `labels`    | Additional labels (namespace, pod, cluster, etc.). |
| `timestamp` | Timestamp of the alert event. |

**Sample log event:**
```json
{
  "alertname": "high_cpu",
  "rule_id": "cpu_rule_1",
  "severity": "critical",
  "state": "firing",
  "value": 0.92,
  "window": 5,
  "for": 30,
  "labels": {
    "namespace": "default",
    "pod": "app-123"
  },
  "timestamp": "2025-08-24T12:00:00Z"
}
```

---

### üìä Metrics (Synthetic & Self-Telemetry)

| Metric Name | Type | One-liner Description |
|-------------|------|------------------------|
| `alertsgen_alerts_total` | Counter | Synthetic counter; increments by 1 per alert event with attributes (`alertname`, `rule_id`, `severity`, `state`, etc.). |
| `alertsgen_eval_duration_seconds` | Histogram/Gauge | Time taken to evaluate all rules in one cycle. |
| `alertsgen_events_total` | Counter | Total number of alert events generated. |
| `alertsgen_active_alerts` | Gauge | Number of currently active (firing) alerts. |
| `alertsgen_dropped_traces_total` | Counter | Count of traces dropped due to memory/backpressure. |
| `alertsgen_dropped_logs_total` | Counter | Count of logs dropped due to memory/backpressure. |
| `alertsgen_dropped_metrics_total` | Counter | Count of metrics dropped due to memory/backpressure. |
| `alertsgen_dropped_total{reason="..."}` | Counter | Count of alert events dropped (e.g., TSDB publish failure). |
| `alertsgen_memory_bytes` | Gauge | Current memory usage by connector buffers. |
| `alertsgen_memory_usage_percent` | Gauge | Memory usage as % of configured maximum. |
| `alertsgen_scale_up_events_total` | Counter | Times buffers were scaled up due to load. |
| `alertsgen_scale_down_events_total` | Counter | Times buffers were scaled down. |
| `alertsgen_memory_pressure_events_total` | Counter | Times memory pressure handling was triggered. |

---

## üõ°Ô∏è Storm Control & Cardinality

- **Storm Control** prevents runaway alert floods with limits per interval/minute.  
- **Cardinality Control** prevents label explosion by trimming or hashing label values, applying blocklists, and enforcing maximum label counts.  
