# OpenTelemetry Collector configuration WITHOUT streaming aggregation (raw metrics passthrough)

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317 # Port for raw metrics

processors:
  # Add raw_ prefix to all metrics
  metricstransform:
    transforms:
      - include: ".*"
        match_type: regexp
        action: update
        new_name: "raw_$$0"

  # Batch processor for efficiency (matches native-histogram-otel)
  batch:
    timeout: 5s
    send_batch_size: 100
    send_batch_max_size: 200

exporters:
  # Prometheus remote write for all metrics (native histograms + regular metrics)
  prometheusremotewrite:
    endpoint: "http://prometheus:9090/api/v1/write"
    tls:
      insecure: true
    resource_to_telemetry_conversion:
      enabled: true
    timeout: 60s
    retry_on_failure:
      enabled: true
      initial_interval: 1s
      max_interval: 30s
      max_elapsed_time: 120s
    add_metric_suffixes: false

service:
  pipelines:
    metrics:
      receivers: [otlp]
      processors: [metricstransform, batch]
      exporters: [prometheusremotewrite]

  telemetry:
    logs:
      level: info
