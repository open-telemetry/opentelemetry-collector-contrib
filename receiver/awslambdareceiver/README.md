# AWS Lambda Receiver
<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: logs, metrics   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fawslambda%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fawslambda) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fawslambda%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fawslambda) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=receiver_awslambda)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=receiver_awslambda&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@MichaelKatsoulis](https://www.github.com/MichaelKatsoulis), [@Kavindu-Dodan](https://www.github.com/Kavindu-Dodan), [@axw](https://www.github.com/axw), [@pjanotti](https://www.github.com/pjanotti) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
<!-- end autogenerated section -->

## Overview

Receiver for collecting logs from AWS services via Lambda invocations. This receiver is designed to run as part of an OpenTelemetry Collector deployed as an AWS Lambda function.

AWS Lambda is a popular serverless service used extensively for event-driven architectures. Many AWS services (S3, CloudWatch, SNS, SQS) can trigger Lambda functions, making it an ideal entry point for collecting data from AWS services.

The `awslambdareceiver` enables users to:

- Collect logs stored in AWS S3 buckets (VPC Flow Logs, ELB Access Logs, CloudTrail, WAF, S3 Access Logs, etc.)
- Ingest CloudWatch Logs via subscription filters
- Process custom JSON logs stored in S3
- Leverage OpenTelemetry's encoding extensions for message parsing

## Primary Use Cases

1. **S3-triggered Log Collection**: Lambda is invoked by S3 event notifications when new log files are created
2. **CloudWatch Logs**: Lambda is invoked by CloudWatch Logs subscription filters

## How It Works

The `awslambdareceiver` operates as follows:

1. Accepts Lambda Invocations
2. Identifies the event source (S3, CloudWatch, etc.)
3. Uses configured encoding extensions to parse the data
4. Creates OpenTelemetry log records
5. Passes parsed logs to the collector pipeline

## Supported Event Sources

### S3 Event Notifications (`s3:ObjectCreated:*`)
- Fetches objects from S3
- Decodes using specified encoding extension

### CloudWatch Logs Subscription Filters
- Decodes CloudWatch Logs data
- Extracts log events
- Uses default `awslogs_encoding` extension with cloudwatch format

## Configuration

The following receiver configuration parameters are supported.

| Name       | Description                                                                                      |
|:-----------|:-------------------------------------------------------------------------------------------------|
| `encoding` | Optional encoder to use for further processing of the payloads retrieved from the Lambda trigger | 

## Supported Trigger Types

- **Logs**: Supported through S3 and CloudWatch Logs event sources
- **Metrics**: Supported through S3

> [!IMPORTANT]  
> Metrics will always be decoded using `awscloudwatchmetricstreams_encoding` extension regardless of the `encoding` parameter set in the receiver configuration.
> Please make sure ingesting metrics can be decoded using this extension.

### Example Configuration

### Example 1: VPC Flow Logs from S3

```yaml
receivers:
  awslambda:
    encoding: awslogs_encoding

extensions:
  awslogs_encoding:
    format: vpcflow
    vpcflow:
      file_format: plain-text

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  extensions:
    - awslogs_encoding
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

In this example, the `awslambdareceiver` is expected to be triggered when a VPC flow log is created at S3 bucket.
The receiver retrieves the log file from S3 and decodes it using the `awslogs_encoding` extension with the vpcflow format.
Parsed logs are forwarded to an OTLP listener via the `otlphttp` exporter.

> [!NOTE]  
> Support is planned for CloudWatch VPC Flow Logs subscription filter.
> Please refer to this [GitHub issue](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/44710)

### Example 2: ELB Access Logs from S3

```yaml
receivers:
  awslambda:
    encoding: awslogs_encoding

extensions:
  awslogs_encoding:
    format: elbaccess
    elbaccess:
      file_format: plain-text

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  extensions:
    - awslogs_encoding
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

### Example 3: CloudWatch Logs using CloudWatch Subscription Filters

```yaml
receivers:
  awslambda:

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

For this deployment configuration, when receiver is triggered by a CloudWatch Logs subscription filter, the CloudWatch
messages will be extracted and converted to an OpenTelemetry log record. These logs then get forwarded to an OTLP listener via the `otlphttp` exporter.

### Example 4: Arbitrary S3 content (logs or metrics)

```yaml
receivers:
  awslambda:

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

For this deployment configuration, when receiver is triggered by an S3 event, 

- Logs: Content of the S3 object will be added to an OpenTelemetry log record. If logs are string, then they will be added as-is.
- Metrics: Metrics are always decoded using `awscloudwatchmetricstreams_encoding` extension.

## AWS Permissions

The Lambda function requires the following IAM permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject"
      ],
      "Resource": "arn:aws:s3:::your-log-bucket/*"
    }
  ]
}
```

## Event Source Detection

The receiver automatically detects the event source based on the Lambda invocation context:

- **S3 Events**: Detected when the event contains S3 bucket and object information
- **CloudWatch Logs**: Detected when the event contains CloudWatch Logs subscription data

## Error Handling

- Detailed error information is logged for debugging
- Retry mechanisms are handled by AWS Lambda

