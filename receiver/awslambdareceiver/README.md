# AWS Lambda Receiver
<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: logs   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fawslambda%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fawslambda) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fawslambda%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fawslambda) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=receiver_awslambda)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=receiver_awslambda&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@MichaelKatsoulis](https://www.github.com/MichaelKatsoulis), [@Kavindu-Dodan](https://www.github.com/Kavindu-Dodan), [@axw](https://www.github.com/axw), [@pjanotti](https://www.github.com/pjanotti) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
<!-- end autogenerated section -->

## Overview

Receiver for collecting logs from AWS services via Lambda invocations. This receiver is designed to run as part of an OpenTelemetry Collector deployed as an AWS Lambda function.

AWS Lambda is a popular serverless service used extensively for event-driven architectures. Many AWS services (S3, CloudWatch, SNS, SQS) can trigger Lambda functions, making it an ideal entry point for collecting data from AWS services.

The `awslambdareceiver` enables users to:

- Collect logs stored in AWS S3 buckets (VPC Flow Logs, ELB Access Logs, CloudTrail, WAF, S3 Access Logs, etc.)
- Ingest CloudWatch Logs via subscription filters
- Process custom JSON logs stored in S3
- Leverage OpenTelemetry's encoding extensions for message parsing

## Primary Use Cases

1. **S3-triggered Log Collection**: Lambda is invoked by S3 event notifications when new log files are created
2. **CloudWatch Logs**: Lambda is invoked by CloudWatch Logs subscription filters

## How It Works

The `awslambdareceiver` operates as follows:

1. Accepts Lambda Invocations
2. Identifies the event source (S3, CloudWatch, etc.)
3. Uses configured encoding extensions to parse the data
4. Creates OpenTelemetry log records
5. Passes parsed logs to the collector pipeline

## Supported Event Sources

### S3 Event Notifications (`s3:ObjectCreated:*`)
- Fetches objects from S3
- Decodes using specified encoding extension

### CloudWatch Logs Subscription Filters
- Decodes CloudWatch Logs data
- Extracts log events
- Uses default `awslogs_encoding` extension with cloudwatch format

## Configuration

The following receiver configuration parameters are supported.

| Name                  | Description                                                                                                                                | Default     | Required |
|:----------------------|:-------------------------------------------------------------------------------------------------------------------------------------------|-------------|----------|
| `s3_encoding`         | Name of the encoding extension to use for S3 objects                                                                                       | "awslogs_encoding" | Optional |

### Example Configuration

```yaml
receivers:
  awslambda:
    s3_encoding: awslogs_encoding

extensions:
  awslogs_encoding:
    format: vpcflow
    vpcflow:
      file_format: plain-text

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  extensions:
    - awslogs_encoding
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

## Examples

### Example 1: VPC Flow Logs from S3

```yaml
receivers:
  awslambda:
    s3_encoding: awslogs_encoding

extensions:
  awslogs_encoding:
    format: vpcflow
    vpcflow:
      file_format: plain-text

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  extensions:
    - awslogs_encoding
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

In this example, `awslambdareceiver` receives a notification when a new VPC flow log file is stored in an S3 bucket. The receiver fetches the log file from S3 and parses it using the `awslogs_encoding` extension with vpcflow format. The parsed logs are then sent to an OTLP listener using the `otlphttp` exporter.

### Example 2: ELB Access Logs from S3

```yaml
receivers:
  awslambda:
    s3_encoding: awslogs_encoding

extensions:
  awslogs_encoding:
    format: elbaccess
    elbaccess:
      file_format: plain-text

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  extensions:
    - awslogs_encoding
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

### Example 3: CloudWatch Logs Subscription

```yaml
receivers:
  awslambda:

exporters:
  otlphttp:
    endpoint: "https://my-backend:443"

service:
  pipelines:
    logs:
      receivers: [awslambda]
      exporters: [otlphttp]
```

In this example, `awslambdareceiver` is invoked by a CloudWatch Logs subscription filter. The receiver automatically parses the CloudWatch Logs data using the default `awslogs_encoding` extension with cloudwatch format. No explicit encoding configuration is needed. The parsed logs are then sent to an OTLP listener using the `otlphttp` exporter.

## Supported Data Types

- **Logs** (Primary support)
- **Metrics** (Future consideration)

## AWS Permissions

The Lambda function requires the following IAM permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject"
      ],
      "Resource": "arn:aws:s3:::your-log-bucket/*"
    }
  ]
}
```

## Event Source Detection

The receiver automatically detects the event source based on the Lambda invocation context:

- **S3 Events**: Detected when the event contains S3 bucket and object information
- **CloudWatch Logs**: Detected when the event contains CloudWatch Logs subscription data

## Error Handling

- Detailed error information is logged for debugging
- Retry mechanisms are handled by AWS Lambda

