apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Name }}-config
  namespace: default
data:
  relay: |
    exporters:
      otlp_grpc:
        endpoint: {{ .HostEndpoint }}:4317
        tls:
          insecure: true
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
    processors:
    receivers:
      k8s_cluster:
        metrics:
          k8s.service.endpoint.count:
            enabled: true
          k8s.service.load_balancer.ingress.count:
            enabled: true
        resource_attributes:
          k8s.service.traffic_distribution:
            enabled: true
          k8s.service.publish_not_ready_addresses:
            enabled: true
    service:
      telemetry:
        logs:
          level: "debug"
      extensions:
      - health_check
      pipelines:
        metrics:
          exporters:
          - otlp_grpc
          receivers:
          - k8s_cluster
