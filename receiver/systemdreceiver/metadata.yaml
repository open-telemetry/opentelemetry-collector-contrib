type: systemd

status:
  class: receiver
  stability:
    development: [metrics]
  distributions: [contrib]
  codeowners:
    active: [Hemansh31, atoulme]
  unsupported_platforms: [darwin, windows]

resource_attributes:
  systemd.unit.name:
    description: Name of the systemd unit
    type: string
    enabled: true

attributes:
  load_state:
    description: The load state of the unit
    type: string
    enum:
      - stub
      - loaded
      - not-found
      - bad-setting
      - error
      - merged
      - masked
  active_state:
    description: The active state of the unit (https://www.freedesktop.org/software/systemd/man/latest/systemd.html#Units)
    type: string
    enum:
      - active
      - reloading
      - inactive
      - failed
      - activating
      - deactivating
      - maintenance
      - refreshing
  sub_state:
    description: The sub state of the serice unit
    type: string
    enum:
      - dead
      - condition
      - start-pre
      - start
      - start-post
      - running
      - exited
      - reload
      - reload-signal
      - reload-notify
      - stop
      - stop-watchdog
      - stop-sigterm
      - stop-sigkill
      - stop-post
      - final-watchdog
      - final-sigterm
      - final-sigkill
      - failed
      - dead-before-auto-restart
      - failed-before-auto-restart
      - dead-resources-pinned
      - auto-restart
      - auto-restart-queued
      - cleaning
      - mounting

metrics:
  systemd.unit.load_state:
    description: The load state of the unit
    enabled: false
    gauge:
      value_type: int
    unit: "{load_state}"
    attributes:
      - load_state
  systemd.unit.active_state:
    description: The active state of the unit (https://www.freedesktop.org/software/systemd/man/latest/systemd.html#Units)
    enabled: false
    gauge:
      value_type: int
    unit: "{active_state}"
    attributes:
      - active_state
  systemd.unit.sub_state:
    description: The sub state of the unit ()
    enabled: false
    gauge:
      value_type: int
    unit: "{sub_state}"
    attributes:
      - sub_state
  systemd.unit.state:
    description: The full state of the unit. The gauge value is the sub state, but all states (load, active, sub) are exposed as attributes
    enabled: true
    gauge:
      value_type: int
    unit: "{state}"
    attributes:
      - load_state
      - active_state
      - sub_state
  systemd.unit.restarts:
    description: Amount of time the unit was restarted this boot
    enabled: true
    gauge:
      aggregation_temporality: cumulative
      monotonic: true
      value_type: int
    unit: "{restarts}"
  systemd.unit.errno:
    description: The errno (exit code) of the last error/exit
    enabled: true
    gauge:
      value_type: int
    unit: "{errno}"

tests:
