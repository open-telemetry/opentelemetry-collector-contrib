type: redis

status:
  class: receiver
  stability:
    beta: [metrics]
  distributions: [contrib]
  codeowners:
    active: [dmitryax, hughesjj]

resource_attributes:
  redis.version:
    description: Redis server's version.
    enabled: true
    type: string
  server.address:
    description: Redis server's address
    enabled: false
    type: string
  server.port:
    description: Redis server's port
    enabled: false
    type: string

attributes:
  cluster_state:
    description: State of the cluster
    type: string
    enum:
      - ok
      - fail
  cmd:
    description: Redis command name
    type: string
  db:
    description: Redis database identifier
    type: string
  percentile:
    description: Percentile
    type: string
    enum:
      - p50
      - p99
      - p99.9
  role:
    description: Redis node's role
    type: string
    enum:
      - replica
      - primary
  state:
    description: Redis CPU usage state
    type: string
    # Redis versions < 6.0 have:
    #   used_cpu_sys: System CPU consumed by the Redis server, which is the sum of system CPU consumed by all threads of the server process (main thread and background threads)
    #   used_cpu_user: User CPU consumed by the Redis server, which is the sum of user CPU consumed by all threads of the server process (main thread and background threads)
    #   used_cpu_sys_children: System CPU consumed by the background processes
    #   used_cpu_user_children: User CPU consumed by the background processes
    # Redis versions >= 6.0 have two more:
    #   used_cpu_sys_main_thread: System CPU consumed by the Redis server main thread
    #   used_cpu_user_main_thread: User CPU consumed by the Redis server main thread
    enum:
      - sys
      - sys_children
      - sys_main_thread
      - user
      - user_children
      - user_main_thread

metrics:
  redis.clients.blocked:
    enabled: true
    description: Number of clients pending on a blocking call
    stability:
      level: development
    unit: "{client}"
    sum:
      value_type: int
      monotonic: false
      aggregation_temporality: cumulative


  redis.clients.connected:
    enabled: true
    description: Number of client connections (excluding connections from replicas)
    stability:
      level: development
    unit: "{client}"
    sum:
      value_type: int
      monotonic: false
      aggregation_temporality: cumulative

  redis.clients.max_input_buffer:
    enabled: true
    description: Biggest input buffer among current client connections
    stability:
      level: development
    unit: "By"
    gauge:
      value_type: int

  redis.clients.max_output_buffer:
    enabled: true
    description: Longest output list among current client connections
    stability:
      level: development
    unit: "By"
    gauge:
      value_type: int

  redis.cluster.known_nodes:
    enabled: false
    description: "Number of known nodes in the cluster"
    stability:
      level: development
    unit: "{node}"
    gauge:
      value_type: int

  redis.cluster.links_buffer_limit_exceeded.count:
    enabled: false
    description: "Total number of times the cluster links buffer limit was exceeded"
    stability:
      level: development
    unit: "{count}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.cluster.node.count:
    enabled: false
    description: "Number of master nodes in the cluster"
    stability:
      level: development
    unit: "{node}"
    gauge:
      value_type: int

  redis.cluster.node.uptime:
    enabled: false
    description: "The node's current epoch"
    stability:
      level: development
    unit: "s"
    gauge:
      value_type: int


  redis.cluster.slots_assigned:
    enabled: false
    description: "Number of slots assigned in the cluster"
    stability:
      level: development
    unit: "{slot}"
    gauge:
      value_type: int

  redis.cluster.slots_fail:
    enabled: false
    description: "Number of slots in the cluster that are in a failing state"
    stability:
      level: development
    unit: "{slot}"
    gauge:
      value_type: int

  redis.cluster.slots_ok:
    enabled: false
    description: "Number of slots in the cluster that are ok"
    stability:
      level: development
    unit: "{slot}"
    gauge:
      value_type: int

  redis.cluster.slots_pfail:
    enabled: false
    description: "Number of slots in the cluster that are in a 'potentially failing' state"
    stability:
      level: development
    unit: "{slot}"
    gauge:
      value_type: int

  redis.cluster.state:
    enabled: false
    description: "State of the cluster"
    stability:
      level: development
    unit: "{state}"
    gauge:
      value_type: int
    attributes: [cluster_state]
  redis.cluster.stats_messages_received:
    enabled: false
    description: "Total number of messages received by the cluster"
    stability:
      level: development
    unit: "{message}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.cluster.stats_messages_sent:
    enabled: false
    description: "Total number of messages sent by the cluster"
    stability:
      level: development
    unit: "{message}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.cluster.uptime:
    enabled: false
    description: "Current epoch of the cluster"
    stability:
      level: development
    unit: "s"
    gauge:
      value_type: int

  redis.cmd.calls:
    enabled: false
    description: Total number of calls for a command
    stability:
      level: development
    unit: "{call}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative
    attributes: [cmd]

  redis.cmd.latency:
    enabled: false
    description: Command execution latency
    stability:
      level: development
    unit: s
    gauge:
      value_type: double
    attributes: [cmd, percentile]

  redis.cmd.usec:
    enabled: false
    description: Total time for all executions of this command
    stability:
      level: development
    unit: us
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative
    attributes: [cmd]
  redis.commands:
    enabled: true
    description: Number of commands processed per second
    stability:
      level: development
    unit: "{ops}/s"
    gauge:
      value_type: int

  redis.commands.processed:
    enabled: true
    description: Total number of commands processed by the server
    stability:
      level: development
    unit: "{command}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.connections.received:
    enabled: true
    description: Total number of connections accepted by the server
    stability:
      level: development
    unit: "{connection}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.connections.rejected:
    enabled: true
    description: Number of connections rejected because of maxclients limit
    stability:
      level: development
    unit: "{connection}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.cpu.time:
    enabled: true
    description: System CPU consumed by the Redis server in seconds since server start
    stability:
      level: development
    unit: s
    sum:
      value_type: double
      monotonic: true
      aggregation_temporality: cumulative
    attributes: [state]

  redis.db.avg_ttl:
    enabled: true
    description: "Average keyspace keys TTL"
    stability:
      level: development
    unit: ms
    gauge:
      value_type: int
    attributes: [db]

  redis.db.expires:
    enabled: true
    description: "Number of keyspace keys with an expiration"
    stability:
      level: development
    unit: "{key}"
    gauge:
      value_type: int
    attributes: [db]
  redis.db.keys:
    enabled: true
    description: "Number of keyspace keys"
    stability:
      level: development
    unit: "{key}"
    gauge:
      value_type: int
    attributes: [db]
  redis.keys.evicted:
    enabled: true
    description: Number of evicted keys due to maxmemory limit
    stability:
      level: development
    unit: "{key}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.keys.expired:
    enabled: true
    description: Total number of key expiration events
    stability:
      level: development
    unit: "{event}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative


  redis.keyspace.hits:
    enabled: true
    description: Number of successful lookup of keys in the main dictionary
    stability:
      level: development
    unit: "{hit}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.keyspace.misses:
    enabled: true
    description: Number of failed lookup of keys in the main dictionary
    stability:
      level: development
    unit: "{miss}"
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.latest_fork:
    enabled: true
    description: Duration of the latest fork operation in microseconds
    stability:
      level: development
    unit: us
    gauge:
      value_type: int

  redis.maxmemory:
    enabled: false
    description: The value of the maxmemory configuration directive
    stability:
      level: development
    unit: By
    gauge:
      value_type: int

  redis.memory.fragmentation_ratio:
    enabled: true
    description: Ratio between used_memory_rss and used_memory
    stability:
      level: development
    unit: "1"
    gauge:
      value_type: double

  redis.memory.lua:
    enabled: true
    description: Number of bytes used by the Lua engine
    stability:
      level: development
    unit: By
    gauge:
      value_type: int

  redis.memory.peak:
    enabled: true
    description: Peak memory consumed by Redis (in bytes)
    stability:
      level: development
    unit: By
    gauge:
      value_type: int

  redis.memory.rss:
    enabled: true
    description: Number of bytes that Redis allocated as seen by the operating system
    stability:
      level: development
    unit: By
    gauge:
      value_type: int

  redis.memory.used:
    enabled: true
    description: Total number of bytes allocated by Redis using its allocator
    stability:
      level: development
    unit: By
    gauge:
      value_type: int

  redis.net.input:
    enabled: true
    description: The total number of bytes read from the network
    stability:
      level: development
    unit: By
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.net.output:
    enabled: true
    description: The total number of bytes written to the network
    stability:
      level: development
    unit: By
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

  redis.rdb.changes_since_last_save:
    enabled: true
    description: Number of changes since the last dump
    stability:
      level: development
    unit: "{change}"
    sum:
      value_type: int
      monotonic: false
      aggregation_temporality: cumulative

  redis.replication.backlog_first_byte_offset:
    enabled: true
    description: The master offset of the replication backlog buffer
    stability:
      level: development
    unit: "By"
    gauge:
      value_type: int

  redis.replication.offset:
    enabled: true
    description: The server's current replication offset
    stability:
      level: development
    unit: "By"
    gauge:
      value_type: int

  # below are all disabled by default
  redis.replication.replica_offset:
    enabled: false
    description: "Offset for redis replica"
    stability:
      level: development
    unit: "By"
    gauge:
      value_type: int

  redis.role:
    enabled: false
    description: Redis node's role
    stability:
      level: development
    unit: "{role}"
    sum:
      value_type: int
      monotonic: false
      aggregation_temporality: cumulative
    attributes: [role]
  redis.slaves.connected:
    enabled: true
    description: Number of connected replicas
    stability:
      level: development
    unit: "{replica}"
    sum:
      value_type: int
      monotonic: false
      aggregation_temporality: cumulative


  redis.uptime:
    enabled: true
    description: Number of seconds since Redis server start
    stability:
      level: development
    unit: s
    sum:
      value_type: int
      monotonic: true
      aggregation_temporality: cumulative

tests:
  config:
    endpoint: localhost:6379
