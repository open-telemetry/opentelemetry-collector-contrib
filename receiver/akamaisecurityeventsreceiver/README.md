# Akamai Security Events Receiver

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: logs   |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fakamaisecurityevents%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fakamaisecurityevents) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fakamaisecurityevents%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fakamaisecurityevents) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@newly12](https://www.github.com/newly12) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

The Akamai Security Events receiver collects security events from Akamai's Security Information and Event Management (SIEM) API. This receiver fetches log data from Akamai's security configurations and transforms them into OpenTelemetry log records.

## Configuration

| Field                   | Default   | Description                                                                                                 |
|-------------------------|-----------|-------------------------------------------------------------------------------------------------------------|
| `endpoint`              | required  | The Akamai API endpoint URL for security events                                                             |
| `config_ids`            | required  | List of unique Akamai security configuration identifiers. For multiple configurations, separate IDs with semicolons |
| `client_token`          | required  | Client token for Akamai EdgeGrid authentication                                                            |
| `client_secret`         | required  | Client secret for Akamai EdgeGrid authentication                                                           |
| `access_token`          | required  | Access token for Akamai EdgeGrid authentication                                                            |
| `limit`                 | `10000`   | Maximum number of events to fetch per request (max 600000)                                                 |
| `parse_rule_data`       | `true`    | Enables parsing of rule data from security events                                                          |
| `flatten_rule_data`     | `false`   | Flattens nested rule data structures into top-level fields                                                 |
| `collection_interval`   | `1m`      | How often to scrape for new events                                                                         |
| `timeout`              | `30s`     | HTTP client timeout for API requests                                                                       |
| `storage`              | none      | ID of a storage extension to persist read offset between restarts                                          |

### Additional HTTP Client Configuration

The receiver supports all standard [HTTP client configuration](https://github.com/open-telemetry/opentelemetry-collector/tree/main/config/confighttp#client-configuration) options.

## Authentication

The receiver uses Akamai's EdgeGrid authentication, which requires three credentials:
- `client_token`: Your API client token
- `client_secret`: Your API client secret  
- `access_token`: Your API access token

These credentials can be obtained from the Akamai Control Center under the "Identity & access" section.

## Offset Management

The receiver maintains an offset to track which events have been processed, ensuring no events are missed or duplicated across collector restarts. The offset is:

- Stored in memory by default (lost on restart)
- Persisted using a storage extension if configured
- Automatically updated after each successful batch of events

## Rule Data Processing

When `parse_rule_data` is enabled (default), the receiver processes attack data from security events:

1. **Rule Data Extraction**: Extracts rule-related fields from the `attackData` attribute
2. **URL Decoding**: Applies URL decoding to rule values
3. **Base64 Decoding**: Decodes base64-encoded rule data
4. **Field Normalization**: Converts plural field names to singular (e.g., `rules` â†’ `rule`)

### Flattening Rule Data

When `flatten_rule_data` is enabled:
- Each parsed rule becomes a separate log record
- Rule data is merged into the main log attributes under `parsedRuleData`
- Original event attributes are preserved in each flattened record

When disabled (default):
- All parsed rules are stored as an array in the `parsedRuleData` attribute
- One log record per original security event

## Example Configuration

### Basic Configuration

```yaml
receivers:
  akamaisecurityevents:
    endpoint: https://akaa-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx.luna.akamaiapis.net
    config_ids: "12345;67890"
    client_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    client_secret: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    access_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    limit: 5000
    collection_interval: 30s
```

### Configuration with Storage

```yaml
extensions:
  file_storage:
    directory: /tmp/otel-storage

receivers:
  akamaisecurityevents:
    endpoint: https://akaa-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx.luna.akamaiapis.net
    config_ids: "12345"
    client_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    client_secret: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    access_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    storage: file_storage
    parse_rule_data: true
    flatten_rule_data: true

service:
  extensions: [file_storage]
  pipelines:
    logs:
      receivers: [akamaisecurityevents]
      exporters: [logging]
```

### Configuration with Custom HTTP Settings

```yaml
receivers:
  akamaisecurityevents:
    endpoint: https://akaa-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx.luna.akamaiapis.net
    config_ids: "12345"
    client_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    client_secret: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    access_token: "akab-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx"
    timeout: 60s
    headers:
      User-Agent: "otel-collector/1.0"
    tls:
      insecure: false
      ca_file: /path/to/ca.crt
```

## Log Record Format

Each security event is transformed into an OpenTelemetry log record with:

- **Timestamp**: Extracted from `httpMessage.start` field when available
- **Observed Timestamp**: Set to current time when the event is processed
- **Attributes**: All fields from the original security event
- **Parsed Rule Data**: Processed rule information (when `parse_rule_data` is enabled)

### Example Log Attributes

```json
{
  "attackData": {
    "clientIP": "192.168.1.100",
    "rules": "base64-encoded-rule-data",
    "ruleMessages": "base64-encoded-messages"
  },
  "httpMessage": {
    "start": "1640995200",
    "method": "GET",
    "uri": "/api/endpoint"
  },
  "parsedRuleData": [
    {
      "rule": "decoded-rule-content",
      "ruleMessage": "decoded-message"
    }
  ]
}
```

## Troubleshooting

### Common Issues

1. **Authentication Errors**: Verify your EdgeGrid credentials are correct and have the necessary permissions
2. **Rate Limiting**: Akamai APIs have rate limits; increase `collection_interval` if you encounter 429 responses
3. **Large Payloads**: If events are large, consider reducing the `limit` parameter to avoid memory issues
4. **Network Timeouts**: Increase the `timeout` setting for slow network connections

### Logging

Enable debug logging to see detailed information about API requests and responses:

```yaml
service:
  telemetry:
    logs:
      level: debug
```

This will log the API URLs being called and offset updates for troubleshooting.