# Cisco OpenTelemetry Receiver

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: metrics   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fciscoos%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fciscoos) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fciscoos%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fciscoos) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=receiver_ciscoosreceiver)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=receiver_ciscoosreceiver&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    |  |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
<!-- end autogenerated section -->

The Cisco OpenTelemetry Receiver (`ciscoosreceiver`) is a modular receiver that collects metrics from Cisco network devices via SSH connections. It supports multiple collectors for comprehensive network monitoring and provides native OpenTelemetry OTLP metrics generation.

## Features

- **Modular Architecture**: Five independent collectors (BGP, Environment, Facts, Interfaces, Optics)
- **Flexible Authentication**: Support for both password and SSH key file authentication
- **Conditional Registration**: Enable/disable collectors based on configuration
- **Native OpenTelemetry**: Direct OTLP metrics generation without conversion
- **Observability Metrics**: Built-in monitoring with connectivity and performance metrics
- **Concurrent Processing**: Parallel device collection with connection pooling
- **Enterprise Ready**: Production-grade error handling and resource management

## Supported Collectors

| Collector | Description | Metrics |
|-----------|-------------|---------|
| **BGP** | BGP session monitoring | Session status, prefix counts, message counts |
| **Environment** | Environmental sensors | Temperature readings, power supply status |
| **Facts** | System information | Uptime, memory usage, CPU utilization |
| **Interfaces** | Network interfaces | Admin/operational status, traffic statistics |
| **Optics** | Optical transceivers | Transmit/receive power levels |

## Configuration

### Basic Configuration

```yaml
receivers:
  ciscoosreceiver:
    collection_interval: 30s
    timeout: 10s
    collectors:
      bgp: true
      environment: true
      facts: true
      interfaces: true
      optics: true
    devices:
      - target: "cisco-device:22"
        username: "admin"
        password: "password"
```

### Authentication Methods

The receiver supports two authentication methods that are mutually exclusive:

#### 1. Password Authentication (Traditional)

```yaml
devices:
  - target: "cisco-router:22"
    username: "admin"
    password: "secure_password"
```

#### 2. SSH Key File Authentication (Recommended for Production)

```yaml
devices:
  # Unencrypted SSH key file
  - target: "cisco-router-1:22"
    username: "admin"
    ssh_key_file: "/path/to/private/key"
    
  # Encrypted SSH key file with passphrase
  - target: "cisco-router-2:22"
    username: "admin"
    ssh_key_file: "/home/user/.ssh/cisco_rsa"
    ssh_key_passphrase: "key_passphrase"
```

#### 3. Mixed Authentication (Multiple Devices)

```yaml
devices:
  # Password authentication for test environment
  - target: "test-device:2222"
    username: "testuser"
    password: "testpass"
    
  # SSH key authentication for production
  - target: "prod-router:22"
    username: "netops"
    ssh_key_file: "/etc/ssh/keys/prod_key"
    ssh_key_passphrase: "secure_passphrase"
```

### Configuration Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `collection_interval` | duration | Yes | How often to collect metrics (e.g., `30s`, `1m`) |
| `timeout` | duration | Yes | SSH connection and command timeout |
| `collectors` | object | Yes | Enable/disable specific collectors |
| `devices` | array | Yes | List of Cisco devices to monitor |

#### Device Configuration

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `target` | string | Yes | Device address in `host:port` format |
| `username` | string | Yes | SSH username for authentication |
| `password` | string | No* | Password for authentication |
| `ssh_key_file` | string | No* | Path to SSH private key file |
| `ssh_key_passphrase` | string | No | Passphrase for encrypted SSH key |

*Either `password` or `ssh_key_file` is required, but not both.

#### Collectors Configuration

```yaml
collectors:
  bgp: true          # BGP session metrics
  environment: true  # Temperature and power metrics  
  facts: true        # System information metrics
  interfaces: true   # Interface status and statistics
  optics: true       # Optical transceiver metrics
```

## SSH Key Authentication Setup

### 1. Generate SSH Key Pair

```bash
# Generate RSA key pair
ssh-keygen -t rsa -b 4096 -f ~/.ssh/cisco_rsa

# Generate Ed25519 key pair (recommended)
ssh-keygen -t ed25519 -f ~/.ssh/cisco_ed25519
```

### 2. Copy Public Key to Cisco Device

```bash
# Copy public key to device
ssh-copy-id -i ~/.ssh/cisco_rsa.pub admin@cisco-device

# Or manually add to device configuration
# configure terminal
# ip ssh pubkey-chain
# username admin
# key-string
# [paste public key content]
# exit
```

### 3. Configure Receiver

```yaml
devices:
  - target: "cisco-device:22"
    username: "admin"
    ssh_key_file: "/home/user/.ssh/cisco_rsa"
```

## Observability Metrics

The receiver generates built-in observability metrics for monitoring and troubleshooting:

| Metric | Type | Description | Labels |
|--------|------|-------------|---------|
| `cisco_up` | Gauge | Device connectivity status (1=connected, 0=disconnected) | `target` |
| `cisco_collector_duration_seconds` | Gauge | Total collection time per device | `target` |
| `cisco_collect_duration_seconds` | Gauge | Individual collector timing | `target`, `collector` |

## Supported Cisco Operating Systems

- **IOS XE**: Full support for all collectors
- **NX-OS**: Full support for all collectors  
- **IOS**: Limited support (no BGP collector)

## Example Configurations

### Production Environment

```yaml
receivers:
  ciscoosreceiver:
    collection_interval: 60s
    timeout: 15s
    collectors:
      bgp: true
      environment: true
      facts: true
      interfaces: true
      optics: false  # Disable if not needed
    devices:
      - target: "core-router-1:22"
        username: "netops"
        ssh_key_file: "/etc/ssh/keys/netops_rsa"
        ssh_key_passphrase: "${SSH_KEY_PASSPHRASE}"
      - target: "core-router-2:22"
        username: "netops"
        ssh_key_file: "/etc/ssh/keys/netops_rsa"
        ssh_key_passphrase: "${SSH_KEY_PASSPHRASE}"

processors:
  batch:
    timeout: 1s
    send_batch_size: 1024
  resource:
    attributes:
      - key: deployment.environment
        value: "production"
        action: upsert

exporters:
  otlphttp:
    endpoint: "https://your-observability-platform.com/v1/metrics"
    headers:
      authorization: "Bearer ${OTLP_TOKEN}"

service:
  pipelines:
    metrics:
      receivers: [ciscoosreceiver]
      processors: [resource, batch]
      exporters: [otlphttp]
```

### Development Environment

```yaml
receivers:
  ciscoosreceiver:
    collection_interval: 30s
    timeout: 10s
    collectors:
      bgp: true
      environment: false
      facts: true
      interfaces: true
      optics: false
    devices:
      - target: "localhost:2222"
        username: "testuser"
        password: "testpass"

processors:
  batch:

exporters:
  debug:
    verbosity: detailed

service:
  pipelines:
    metrics:
      receivers: [ciscoosreceiver]
      processors: [batch]
      exporters: [debug]
```

## Security Best Practices

### SSH Key Authentication

1. **Use SSH Key Authentication**: Preferred over passwords for production environments
2. **Encrypt Private Keys**: Use passphrases to encrypt SSH private keys
3. **Restrict Key Permissions**: Set proper file permissions (`chmod 600`) on private keys
4. **Rotate Keys Regularly**: Implement key rotation policies
5. **Use Environment Variables**: Store sensitive data in environment variables

### Network Security

1. **Limit SSH Access**: Restrict SSH access to management networks only
2. **Use Non-Standard Ports**: Consider using non-standard SSH ports
3. **Enable SSH Key-Only Authentication**: Disable password authentication on devices
4. **Monitor SSH Sessions**: Log and monitor SSH connection attempts

## Troubleshooting

### Common Issues

#### SSH Connection Failures

```
Error: failed to connect to device:22: ssh: handshake failed
```

**Solutions:**
- Verify device SSH configuration
- Check network connectivity
- Validate SSH key permissions
- Ensure correct username/authentication method

#### Authentication Failures

```
Error: failed to create SSH key authentication: failed to parse SSH key
```

**Solutions:**
- Verify SSH key file format (OpenSSH format required)
- Check SSH key file permissions
- Validate passphrase if key is encrypted
- Ensure key is not corrupted

#### Parser Errors

```
Error: failed to parse command output
```

**Solutions:**
- Verify device OS compatibility
- Check command output format
- Enable debug logging for detailed output
- Validate device configuration

### Debug Configuration

```yaml
receivers:
  ciscoosreceiver:
    # ... normal config ...

exporters:
  debug:
    verbosity: detailed
  logging:
    loglevel: debug

service:
  telemetry:
    logs:
      level: debug
  pipelines:
    metrics:
      receivers: [ciscoosreceiver]
      exporters: [debug, logging]
```

## Performance Tuning

### Collection Intervals

- **High-frequency monitoring**: 15-30 seconds
- **Standard monitoring**: 60-300 seconds  
- **Low-frequency monitoring**: 300-900 seconds

### Timeout Settings

- **Local network**: 5-10 seconds
- **WAN connections**: 10-30 seconds
- **Slow devices**: 30-60 seconds

### Collector Selection

Disable unnecessary collectors to improve performance:

```yaml
collectors:
  bgp: true          # Essential for routing monitoring
  environment: true  # Important for hardware health
  facts: false       # Disable if system info not needed
  interfaces: true   # Essential for network monitoring
  optics: false      # Disable if optical monitoring not required
```

## Testing

Use the included `openobserve-config.yaml` for testing:

```bash
# Set environment variables
export CISCO_TARGET="localhost:2222"
export CISCO_USERNAME="testuser" 
export CISCO_PASSWORD="testpass"

# Run collector
otelcol --config openobserve-config.yaml
```

### Environment Variables for Testing

```bash
export CISCO_TARGET="localhost:2222"
export CISCO_USERNAME="testuser"  
export CISCO_PASSWORD="testpass"
export OPENOBSERVE_ENDPOINT="https://your-openobserve.com/api/default"
export OPENOBSERVE_AUTH="Basic <base64-encoded-credentials>"
```

## Contributing

This receiver follows the OpenTelemetry Collector Contrib development guidelines. For contributions, please refer to the main repository documentation.

## License

This receiver is licensed under the Apache License 2.0.
