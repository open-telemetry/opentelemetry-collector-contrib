# Google Cloud LogEntry encoding extension

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [alpha]  |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aextension%2Fgooglecloudlogentryencoding%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aextension%2Fgooglecloudlogentryencoding) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aextension%2Fgooglecloudlogentryencoding%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aextension%2Fgooglecloudlogentryencoding) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@constanca-m](https://www.github.com/constanca-m) |
| Emeritus      | [@alexvanboxel](https://www.github.com/alexvanboxel) |

[alpha]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#alpha
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

This extension can be used to unmarshall a [Cloud Logging LogEntry](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry) message type. Currently, this extension can only decode one log at a time.

The following configuration options are supported:

* `handle_json_payload_as` (Optional): This controls how the json payload of the log entry  is parsed into the body.
  The default `json` parses it as standard JSON, while `text` will the put the payload as a single string.
* `handle_proto_payload_as` (Optional): This controls how the json payload of the log entry  is parsed into the body. 
  The default `json` parses it as standard JSON, while `proto` will use the well known protobuf types used in a
  log entry providing a better type handling, but sacrificing stability. Using `text` will the put the payload as a
  single string.

## Log entry fields mapping

The [log entry](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry) fields are mapped this way in the encoding:


| Original JSON Field Name                     | OpenTelemetry log field                                                                                                                                                            |
|----------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `receiveTimestamp`                           | Log record field: `observedTimeUnixNano`                                                                                                                                           |
| `timestamp`                                  | Log record field: `timeUnixNano`                                                                                                                                                   |
| `insertId`                                   | Log record attribute: `log.record.uid`                                                                                                                                             |
| `logName`                                    | Parse it and place it in the resource log attributes, if present:<br>1.`gcp.project`<br>2.`gcp.organization`<br>3.`gcp.billint_account`<br>4.`gcp.folder`<br>5.`cloud.resource_id` |
| `severity`                                   | Parse it and place in log record fields:<br>1.`severityNumber`<br>2.`severityText`                                                                                                 |
| `trace`                                      | Log record field: `traceId`                                                                                                                                                        |
| `spanId`                                     | Log record field: `spanId`                                                                                                                                                         |
| `traceSampled`                               | Log record field: `flags`                                                                                                                                                          |
| `labels`                                     | Log record attribute: `gcp.label.<label_key>`                                                                                                                                      |
| `httpRequest.requestMethod`                  | Log record attribute: `http_request.request_method`                                                                                                                                |
| `httpRequest.requestUrl`                     | Log record attribute: `url.full`<br>Parse it, and place it in the log record attributes:<br>1.`url.path`<br>2.`url.query`<br>3.`url.domain`                                        |
| `httpRequest.requestSize`                    | Log record attribute: `http.request.size`                                                                                                                                          |
| `httpRequest.status`                         | Log record attribute: `http.response.status_code`                                                                                                                                  |
| `httpRequest.responseSize`                   | Log record attribute: `http.response.size`                                                                                                                                         |
| `httpRequest.userAgent`                      | Log record attribute: `user_agent.original`                                                                                                                                        |
| `httpRequest.remoteIp`                       | Log record attribute: `client.address`                                                                                                                                             |
| `httpRequest.serverIp`                       | Log record attribute: `server.address`                                                                                                                                             |
| `httpRequest.referer`                        | Log record attribute: `http.request.header.referer`                                                                                                                                |
| `httpRequest.latency`                        | Log record attribute: `http.request.server.duration`                                                                                                                               |
| `httpRequest.cacheLookup`                    | Log record attribute: `gcp.cache.lookup`                                                                                                                                           |
| `httpRequest.cacheHit`                       | Log record attribute: `gcp.cache.hit`                                                                                                                                              |
| `httpRequest.cacheValidatedWithOriginServer` | Log record attribute: `gcp.cache.validated_with_origin_server`                                                                                                                     |
| `httpRequest.cacheFillBytes`                 | Log record attribute: `gcp.cache.fill_bytes`                                                                                                                                       |
| `httpRequest.protocol`                       | Parse it, and place it in log record attribute:<br>1.`network.protocol.name`.<br>2.`network.protocol.version`                                                                      |
| `resource.type`                              | Resource log attribute: `gcp.resource_type`                                                                                                                                        |
| `resource.labels`                            | Resource log attribute: `gcp.label.<label_key>`                                                                                                                                    |
| `operation.id`                               | Log record attribute: `gcp.operation.id`                                                                                                                                           |
| `operation.producer`                         | Log record attribute: `gcp.operation.producer`                                                                                                                                     |
| `operation.first`                            | Log record attribute: `gcp.operation.first`                                                                                                                                        |
| `operation.last`                             | Log record attribute: `gcp.operation.last`                                                                                                                                         |
| `sourceLocation.file`                        | Log record attribute: `code.file.path`                                                                                                                                             |
| `sourceLocation.line`                        | Log record attribute: `code.line.number`                                                                                                                                           |
| `sourceLocation.function`                    | Log record attribute: `code.function.name`                                                                                                                                         |
| `protoPayload`                               | Placed on the record body as is                                                                                                                                                    |
| `textPayload`                                | Placed on the record body as is                                                                                                                                                    |
| `jsonPayload`                                | Placed on the record body as is                                                                                                                                                    |
| `split.uid`                                  | Log record attribute: `gcp.split.uid`                                                                                                                                              |                                                                         |
| `split.index`                                | Log record attribute: `gcp.split.index`                                                                                                                                            |                                                                         |
| `split.totalSplits`                          | Log record attribute: `gcp.split.total`                                                                                                                                            |                                                                         |
| `errorGroups[].id`                           | Log record attribute: `gcp.error_groups` list<br>Each element has attribute `id`                                                                                                   |                                                                         |
| `apphub.application.container`               | Log record attribute: `gcp.apphub.application.container`                                                                                                                           |                                                                         |
| `apphub.application.location`                | Log record attribute: `gcp.apphub.application.location`                                                                                                                            |                                                                         |
| `apphub.application.id`                      | Log record attribute: `gcp.apphub.application.id`                                                                                                                                  |                                                                         |
| `apphub.service.id`                          | Log record attribute: `gcp.apphub.service.id`                                                                                                                                      |                                                                         |
| `apphub.service.environmentType`             | Log record attribute: `gcp.apphub.service.environment_type`                                                                                                                        |                                                                         |
| `apphub.service.criticalityType`             | Log record attribute: `gcp.apphub.service.criticality_type`                                                                                                                        |                                                                         |
| `apphub.workload.id`                         | Log record attribute: `gcp.apphub.workload.id`                                                                                                                                     |                                                                         |
| `apphub.workload.environmentType`            | Log record attribute: `gcp.apphub.workload.environment_type`                                                                                                                       |                                                                         |
| `apphub.workload.criticalityType`            | Log record attribute: `gcp.apphub.workload.criticality_type`                                                                                                                       |                                                                         |
| `apphubDestination.application.container`    | Log record attribute: `gcp.apphub_destination.application.container`                                                                                                               |                                                                         |
| `apphubDestination.application.location`     | Log record attribute: `gcp.apphub_destination.application.location`                                                                                                                |                                                                         |
| `apphubDestination.application.id`           | Log record attribute: `gcp.apphub_destination.application.id`                                                                                                                      |                                                                         |
| `apphubDestination.service.id`               | Log record attribute: `gcp.apphub_destination.service.id`                                                                                                                          |                                                                         |
| `apphubDestination.service.environmentType`  | Log record attribute: `gcp.apphub_destination.service.environment_type`                                                                                                            |                                                                         |
| `apphubDestination.service.criticalityType`  | Log record attribute: `gcp.apphub_destination.service.criticality_type`                                                                                                            |                                                                         |
| `apphubDestination.workload.id`              | Log record attribute: `gcp.apphub_destination.workload.id`                                                                                                                         |                                                                         |
| `apphubDestination.workload.environmentType` | Log record attribute: `gcp.apphub_destination.workload.environment_type`                                                                                                           |                                                                         |
| `apphubDestination.workload.criticalityType` | Log record attribute: `gcp.apphub_destination.workload.criticality_type`                                                                                                           |                                                                         |

#### Severity Mapping

The severity is mapped from [Google Cloud Log Severity](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry#LogSeverity) like this:

| CloudLog         | Severity Number  | CloudLog Description                                                                   |
|------------------|------------------|----------------------------------------------------------------------------------------|
| `DEFAULT`(0)     | `UNSPECIFIED`(0) | The log entry has no assigned severity level.                                          |
| `DEBUG`(100)     | `DEBUG`(5)       | Debug or trace information.                                                            |
| `INFO`(200)      | `INFO`(9)        | Routine information, such as ongoing status or performance.                            |
| `NOTICE`(300)    | `INFO2`(10)      | Normal but significant events, such as start up, shut down, or a configuration change. |
| `WARNING`(400)   | `WARN`(13)       | Warning events might cause problems.                                                   |
| `ERROR`(500)     | `ERROR`(17)      | Error events are likely to cause problems.                                             |
| `CRITICAL`(600)  | `FATAL`(21)      | Critical events cause more severe problems or outages.                                 |
| `ALERT`(700)     | `FATAL2`(22)     | A person must take an action immediately.                                              |
| `EMERGENCY`(800) | `FATAL4`(24)     | One or more systems are unusable.                                                      |