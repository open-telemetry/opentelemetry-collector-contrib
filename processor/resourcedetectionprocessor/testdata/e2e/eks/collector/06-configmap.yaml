apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Name }}-config
  namespace: default
data:
  relay: |
    exporters:
      otlp:
        endpoint: {{ .HostEndpoint }}:4317
        tls:
          insecure: true
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
    processors:
      resourcedetection:
        detectors: [eks]
        timeout: 2s
        override: false
        eks:
          node_from_env_var: K8S_NODE_NAME
          resource_attributes:
            cloud.account.id:
              enabled: true
            cloud.availability_zone:
              enabled: true
            cloud.region:
              enabled: true
            host.id:
              enabled: true
            host.name:
              enabled: true
            host.type:
              enabled: true
            host.image.id:
              enabled: true
    receivers:
      hostmetrics:
        collection_interval: 1s
        scrapers:
          cpu:
    service:
      telemetry:
        logs:
          level: "debug"
      extensions:
        - health_check
      pipelines:
        metrics:
          receivers:
            - hostmetrics
          processors:
            - resourcedetection
          exporters:
            - otlp
