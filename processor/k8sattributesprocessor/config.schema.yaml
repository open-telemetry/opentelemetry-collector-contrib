$defs:
  exclude_config:
    description: ExcludeConfig represent a list of Pods to exclude
    type: object
    properties:
      pods:
        type: array
        items:
          $ref: exclude_pod_config
  exclude_pod_config:
    description: ExcludePodConfig represent a Pod name to ignore
    type: object
    properties:
      name:
        type: string
  extract_config:
    description: ExtractConfig section allows specifying extraction rules to extract data from k8s pod specs.
    type: object
    properties:
      annotations:
        description: Annotations allows extracting data from pod annotations and record it as resource attributes. It is a list of FieldExtractConfig type. See FieldExtractConfig documentation for more details.
        type: array
        items:
          $ref: field_extract_config
      deployment_name_from_replicaset:
        description: DeploymentNameFromReplicaSet allows extracting deployment name from replicaset name by trimming pod template hash. This will disable watching for replicaset resources.
        type: boolean
      labels:
        description: Labels allows extracting data from pod labels and record it as resource attributes. It is a list of FieldExtractConfig type. See FieldExtractConfig documentation for more details.
        type: array
        items:
          $ref: field_extract_config
      metadata:
        description: 'Metadata allows to extract pod/namespace/node metadata from a list of metadata fields. The field accepts a list of strings. Metadata fields supported right now are, k8s.pod.name, k8s.pod.uid, k8s.deployment.name, k8s.node.name, k8s.namespace.name, k8s.pod.start_time, k8s.replicaset.name, k8s.replicaset.uid, k8s.daemonset.name, k8s.daemonset.uid, k8s.job.name, k8s.job.uid, k8s.cronjob.name, k8s.cronjob.uid, k8s.statefulset.name, k8s.statefulset.uid, k8s.container.name, container.id, container.image.name, container.image.tag, container.image.repo_digests k8s.cluster.uid Specifying anything other than these values will result in an error. By default, the following fields are extracted and added to spans, metrics and logs as resource attributes: - k8s.pod.name - k8s.pod.uid - k8s.pod.start_time - k8s.namespace.name - k8s.node.name - k8s.deployment.name (if the pod is controlled by a deployment) - k8s.container.name (requires an additional attribute to be set: container.id) - container.image.name (requires one of the following additional attributes to be set: container.id or k8s.container.name) - container.image.tag (requires one of the following additional attributes to be set: container.id or k8s.container.name)'
        type: array
        items:
          type: string
      otel_annotations:
        description: OtelAnnotations extracts all pod annotations with the prefix "resource.opentelemetry.io" as resource attributes E.g. "resource.opentelemetry.io/foo" becomes "foo"
        type: boolean
  field_extract_config:
    description: FieldExtractConfig allows specifying an extraction rule to extract a resource attribute from pod (or namespace) annotations (or labels).
    type: object
    properties:
      from:
        description: From represents the source of the labels/annotations. Allowed values are "pod", "namespace", and "node". The default is pod.
        type: string
      key:
        description: Key represents the annotation (or label) name. This must exactly match an annotation (or label) name.
        type: string
      key_regex:
        description: KeyRegex is a regular expression used to extract a Key that matches the regex. Out of Key or KeyRegex, only one option is expected to be configured at a time.
        type: string
      tag_name:
        description: 'TagName represents the name of the resource attribute that will be added to logs, metrics or spans. When not specified, a default tag name will be used of the format: - k8s.pod.annotations.<annotation key>  (or k8s.pod.annotation.<annotation key> when k8sattr.labelsAnnotationsSingular.allow is enabled) - k8s.pod.labels.<label key>  (or k8s.pod.label.<label key> when k8sattr.labelsAnnotationsSingular.allow is enabled) For example, if tag_name is not specified and the key is git_sha, then the attribute name will be `k8s.pod.annotations.git_sha` (or `k8s.pod.annotation.git_sha` with the feature gate). When key_regex is present, tag_name supports back reference to both named capturing and positioned capturing. For example, if your pod spec contains the following labels, app.kubernetes.io/component: mysql app.kubernetes.io/version: 5.7.21 and you''d like to add tags for all labels with prefix app.kubernetes.io/ and also trim the prefix, then you can specify the following extraction rules: extract: labels: - tag_name: $$1 key_regex: kubernetes.io/(.*) this will add the `component` and `version` tags to the spans or metrics.'
        type: string
  field_filter_config:
    description: FieldFilterConfig allows specifying exactly one filter by a field. It can be used to represent a label or generic field filter.
    type: object
    properties:
      key:
        description: Key represents the key or name of the field or labels that a filter can apply on.
        type: string
      op:
        description: 'Op represents the filter operation to apply on the given Key: Value pair. The following operations are supported equals, not-equals, exists, does-not-exist.'
        type: string
      value:
        description: Value represents the value associated with the key that a filter operation specified by the `Op` field applies on.
        type: string
  filter_config:
    description: FilterConfig section allows specifying filters to filter pods by labels, fields, namespaces, nodes, etc.
    type: object
    properties:
      fields:
        description: 'Fields allows to filter pods by generic k8s fields. Only the following operations are supported: - equals - not-equals Check FieldFilterConfig for more details.'
        type: array
        items:
          $ref: field_filter_config
      labels:
        description: 'Labels allows to filter pods by generic k8s pod labels. Only the following operations are supported: - equals - not-equals - exists - not-exists Check FieldFilterConfig for more details.'
        type: array
        items:
          $ref: field_filter_config
      namespace:
        description: Namespace filters all pods by the provided namespace. All other pods are ignored.
        type: string
      node:
        description: Node represents a k8s node or host. If specified, any pods not running on the specified node will be ignored by the tagger.
        type: string
      node_from_env_var:
        description: 'NodeFromEnv can be used to extract the node name from an environment variable. The value must be the name of the environment variable. This is useful when the node a Otel agent will run on cannot be predicted. In such cases, the Kubernetes downward API can be used to add the node name to each pod as an environment variable. K8s tagger can then read this value and filter pods by it. For example, node name can be passed to each agent with the downward API as follows env: - name: K8S_NODE_NAME valueFrom: fieldRef: fieldPath: spec.nodeName Then the NodeFromEnv field can be set to `K8S_NODE_NAME` to filter all pods by the node that the agent is running on. More on downward API here: https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/'
        type: string
  pod_association_config:
    description: PodAssociationConfig contain single rule how to associate Pod metadata with logs, spans and metrics
    type: object
    properties:
      sources:
        description: List of pod association sources which should be taken to identify pod
        type: array
        items:
          $ref: pod_association_source_config
  pod_association_source_config:
    type: object
    properties:
      from:
        description: From represents the source of the association. Allowed values are "connection" and "resource_attribute".
        type: string
      name:
        description: Name represents extracted key name. e.g. ip, pod_uid, k8s.pod.ip
        type: string
description: Config defines configuration for k8s attributes processor.
type: object
properties:
  exclude:
    description: Exclude section allows to define names of pod that should be ignored while tagging.
    $ref: exclude_config
  extract:
    description: Extract section allows specifying extraction rules to extract data from k8s pod specs
    $ref: extract_config
  filter:
    description: Filter section allows specifying filters to filter pods by labels, fields, namespaces, nodes, etc.
    $ref: filter_config
  passthrough:
    description: Passthrough mode only annotates resources with the pod IP and does not try to extract any other metadata. It does not need access to the K8S cluster API. Agent/Collector must receive spans directly from services to be able to correctly detect the pod IPs.
    type: boolean
  pod_association:
    description: Association section allows to define rules for tagging spans, metrics, and logs with Pod metadata.
    type: array
    items:
      $ref: pod_association_config
  wait_for_metadata:
    description: WaitForMetadata is a flag that determines if the processor should wait k8s metadata to be synced when starting.
    type: boolean
  wait_for_metadata_timeout:
    description: WaitForMetadataTimeout is the maximum time the processor will wait for the k8s metadata to be synced.
    type: string
    format: duration
allOf:
  - $ref: github.com/open-telemetry/opentelemetry-collector-contrib/internal/k8sconfig.api_config
